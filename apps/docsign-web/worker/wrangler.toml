name = "docsign-worker"
main = "build/worker/shim.mjs"
compatibility_date = "2024-01-01"

# Account ID - set via environment or wrangler login
# account_id = "YOUR_ACCOUNT_ID"

# For local development, use workers.dev subdomain
workers_dev = true

# Build configuration for Rust WASM worker
[build]
command = "cargo install -q worker-build && worker-build --release"

# KV Namespace bindings
# Create these in Cloudflare dashboard first, then add IDs:
# wrangler kv:namespace create "SESSIONS"
# wrangler kv:namespace create "RATE_LIMITS"
# wrangler kv:namespace create "VERIFICATIONS"
[[kv_namespaces]]
binding = "SESSIONS"
id = ""  # Add after creating: wrangler kv:namespace create "SESSIONS"

[[kv_namespaces]]
binding = "RATE_LIMITS"
id = ""  # Add after creating: wrangler kv:namespace create "RATE_LIMITS"

[[kv_namespaces]]
binding = "VERIFICATIONS"
id = ""  # Add after creating: wrangler kv:namespace create "VERIFICATIONS"

# Environment variables (non-secret)
[vars]
DAILY_LIMIT = "100"
MONTHLY_LIMIT = "3000"

# Secrets (set via wrangler secret put):
# wrangler secret put RESEND_API_KEY
# wrangler secret put DOCSIGN_API_KEY

# =============================================================
# Development environment
# =============================================================
[env.dev]
workers_dev = true
vars = { DAILY_LIMIT = "10", MONTHLY_LIMIT = "100" }

[[env.dev.kv_namespaces]]
binding = "SESSIONS"
id = ""  # Add dev namespace ID

[[env.dev.kv_namespaces]]
binding = "RATE_LIMITS"
id = ""  # Add dev namespace ID

[[env.dev.kv_namespaces]]
binding = "VERIFICATIONS"
id = ""  # Add dev namespace ID

# =============================================================
# Staging environment
# =============================================================
[env.staging]
workers_dev = true
vars = { DAILY_LIMIT = "50", MONTHLY_LIMIT = "500" }

[[env.staging.kv_namespaces]]
binding = "SESSIONS"
id = ""  # Add staging namespace ID

[[env.staging.kv_namespaces]]
binding = "RATE_LIMITS"
id = ""  # Add staging namespace ID

[[env.staging.kv_namespaces]]
binding = "VERIFICATIONS"
id = ""  # Add staging namespace ID

# =============================================================
# Production environment
# =============================================================
[env.production]
workers_dev = false
routes = [
  { pattern = "api.getsignatures.org/*", zone_name = "getsignatures.org" }
]
vars = { DAILY_LIMIT = "100", MONTHLY_LIMIT = "3000" }

[[env.production.kv_namespaces]]
binding = "SESSIONS"
id = ""  # Add production namespace ID

[[env.production.kv_namespaces]]
binding = "RATE_LIMITS"
id = ""  # Add production namespace ID

[[env.production.kv_namespaces]]
binding = "VERIFICATIONS"
id = ""  # Add production namespace ID
