name = "docsign-worker"
main = "build/worker/shim.mjs"
compatibility_date = "2024-01-01"

# Account ID - set via environment or wrangler login
# account_id = "YOUR_ACCOUNT_ID"

# For local development, use workers.dev subdomain
workers_dev = true

# Build configuration for Rust WASM worker
[build]
command = "cargo install -q worker-build && worker-build --release"

# KV Namespace bindings
[[kv_namespaces]]
binding = "SESSIONS"
id = "0bf12b5d4fca450b8c4fab1d3ef58a96"

[[kv_namespaces]]
binding = "RATE_LIMITS"
id = "9384f737469a494db2f447c5c57743f4"

[[kv_namespaces]]
binding = "VERIFICATIONS"
id = "1929d880b7944f239a91032379a39eec"

# User authentication KV namespaces
# Create with: wrangler kv namespace create USERS
[[kv_namespaces]]
binding = "USERS"
id = "PLACEHOLDER_USERS_ID"

# Create with: wrangler kv namespace create AUTH_SESSIONS
[[kv_namespaces]]
binding = "AUTH_SESSIONS"
id = "PLACEHOLDER_AUTH_SESSIONS_ID"

# Environment variables (non-secret)
[vars]
ALLOW_DUPLICATE_EMAILS = "true"  # For testing - allows same email for multiple signers
EMAIL_FROM = "GetSignatures <noreply@getsignatures.org>"  # Sender address for emails

# Secrets (set via wrangler secret put):
# wrangler secret put DOCSIGN_API_KEY      # API key for protected endpoints
# wrangler secret put TOKEN_SECRET         # Secret for signing recipient tokens
# wrangler secret put RESEND_API_KEY       # Resend API key for email sending
# wrangler secret put JWT_SECRET           # Secret for signing JWT auth tokens (min 32 bytes)

# =============================================================
# Production environment
# =============================================================
[env.production]
workers_dev = false
routes = [
  { pattern = "api.getsignatures.org/*", zone_name = "getsignatures.org" }
]
# Production: ALLOW_DUPLICATE_EMAILS not set = defaults to false (prevents same email for multiple signers)

[env.production.vars]
EMAIL_FROM = "GetSignatures <noreply@getsignatures.org>"

[[env.production.kv_namespaces]]
binding = "SESSIONS"
id = "0bf12b5d4fca450b8c4fab1d3ef58a96"

[[env.production.kv_namespaces]]
binding = "RATE_LIMITS"
id = "9384f737469a494db2f447c5c57743f4"

[[env.production.kv_namespaces]]
binding = "VERIFICATIONS"
id = "1929d880b7944f239a91032379a39eec"

[[env.production.kv_namespaces]]
binding = "USERS"
id = "PLACEHOLDER_USERS_ID"

[[env.production.kv_namespaces]]
binding = "AUTH_SESSIONS"
id = "PLACEHOLDER_AUTH_SESSIONS_ID"
